![ignorance](http://dl.dropbox.com/u/3057627/ignorance/ignorance-small.png)

<h1>A little <strong>Domain Driven Development</strong> framework that embodies Persistence Ignorance and features those <em>Unit of Work</em>, <em>Repository</em>, and <em>Inversion of Control</em> patterns you keep hearing so much about.</h1>

<p>Only, now you're not pecking them out and maintaining them in your application code, because <strong><em>Ignorance</em> already did that</strong>.</p>

<p>So, in much the same way that your business logic will be carefree and clueless about how your data is persisted, <em>you</em> get to skip down the hallway and be all, &quot;la la, business code, business code&quot;, and not give two squirts about implementing another <em>IRepository</em>.</p>

<h2>You Know I'm Not Switching To Another ORM Tomorrow, Right?</h2>

<p>Yep. Because that's exactly what I said.</p>

<p>But let's say you have this amazing web app, and now you want to build out a occasionally-connected native client for it. Well, now your logic needs to work with local storage. And that local storage<a href="http://msdn.microsoft.com/en-us/library/hh202860(v=VS.92).aspx" target="_blank"> doesn't do Entity Framework</a>. If your domain and client logic is peppered with Entity Framework-specific hooks, you can't just reuse that DLL. That DLL that already contains your carefully curated and tested and trusted domain logic. That DLL that is the<em> heart and identity of your application</em>.</p>

<p><em>Persistence Ignorance</em> makes that logic portable, self-contained, instantly reusable. What's more, it's dead simple to test what's unique and important about your app. Mock up your database, don't muck up your database.</p>

<h2>Just Show Me The Code</h2>

<p>Okay. So your client code will be all:</p>

<pre style="background: white"><span style="font-family: consolas"><span><span style="color: #008000"><span>// hey kids, let's add a new contact&#160; </span></span></span><span><br /><span><span style="color: #0000ff">using</span></span> (<span><span style="color: #0000ff">var</span></span> work = Ignorance.<span><span style="color: #2b91af">Create</span></span>.Work())<br />{<br />&#160;&#160;&#160; <span><span style="color: #008000">// create a service object,&#160;&#160; </span></span><br />&#160;&#160;&#160; <span><span style="color: #008000">// which houses any logic around data types&#160; </span></span><br />&#160;&#160;&#160; <span><span style="color: #0000ff">var</span></span> contacts = <span><span style="color: #0000ff">new</span></span>&#160;<span><span style="color: #2b91af">ContactService</span></span>(work);<br /> <br />&#160;&#160;&#160; <span><span style="color: #008000">// instantiate &amp; init a new contact object</span></span><br />&#160;&#160;&#160; <span><span style="color: #0000ff">var</span></span> c = contacts.Create();<br />&#160;&#160;&#160; c.FirstName = <span><span style="color: #a31515">&quot;Merlin&quot;</span></span>;<br />&#160;&#160;&#160; c.LastName = <span><span style="color: #a31515">&quot;Mann&quot;</span></span>;<br />&#160;&#160;&#160; c.Title = <span><span style="color: #a31515">&quot;Hi. Can I Axe You A Question?&quot;</span></span>;<br /> <br />&#160;&#160;&#160; <span><span style="color: #008000">// add it to your list of contacts (repository)</span></span><br />&#160;&#160;&#160; contacts.Add(c);<br /> <br />&#160;&#160;&#160; <span><span style="color: #008000">// validate and commit changes</span></span><br />&#160;&#160;&#160; work.Save();<br />}&#160;&#160;&#160;&#160;&#160;&#160; </span></span></pre>

<p>Then, your logic/business/domain code is all:</p>

<pre style="background: white"><span style="font-family: consolas"><span><span style="color: #0000ff"><span>using</span></span></span><span> System;<br /><span><span style="color: #0000ff">using</span></span> System.Collections.Generic;<br /><span><span style="color: #0000ff">using</span></span> Ignorance;<br /><span><span style="color: #0000ff">using</span></span> Ignorance.Domain;<br /><span><span style="color: #0000ff">using</span></span> YourApplicationHere.Data;<br /> <br /><span><span style="color: #0000ff">namespace</span></span> YourApplicationHere.Domain<br />{<br />&#160;&#160;&#160; <span><span style="color: #0000ff">public</span></span>&#160;<span><span style="color: #0000ff">class</span></span>&#160;<span><span style="color: #2b91af">ContactService</span></span> : <span><span style="color: #2b91af">Service</span></span>&lt;<span><span style="color: #2b91af">Contact</span></span>&gt;<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">public</span></span> ContactService(<span><span style="color: #2b91af">IWork</span></span> work) : <span><span style="color: #0000ff">base</span></span>(work) { }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">protected</span></span>&#160;<span><span style="color: #0000ff">override</span></span>&#160;<span><span style="color: #0000ff">void</span></span> OnCreated(<span><span style="color: #2b91af">Contact</span></span> entity)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; entity.FirstName = <span><span style="color: #a31515">&quot;New&quot;</span></span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; entity.LastName = <span><span style="color: #a31515">&quot;Guy&quot;</span></span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; entity.Suffix = <span><span style="color: #a31515">&quot;Esq.&quot;</span></span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">protected</span></span>&#160;<span><span style="color: #0000ff">override</span></span>&#160;<span><span style="color: #0000ff">void</span></span> OnSaving(<span><span style="color: #2b91af">Contact</span></span> entity)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">if</span></span> (!entity.EmailAddress.Contains(<span><span style="color: #a31515">&quot;@&quot;</span></span>))<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">throw</span></span>&#160;<span><span style="color: #0000ff">new</span></span>&#160;<span><span style="color: #2b91af">ApplicationException</span></span>(<span><span style="color: #a31515">&quot;That's not an email address.&quot;</span></span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">protected</span></span>&#160;<span><span style="color: #0000ff">override</span></span>&#160;<span><span style="color: #0000ff">void</span></span> OnDeleting(<span><span style="color: #2b91af">Contact</span></span> entity)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">if</span></span> (entity.LastName == <span><span style="color: #a31515">&quot;Fazzaro&quot;</span></span>)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">throw</span></span>&#160;<span><span style="color: #0000ff">new</span></span>&#160;<span><span style="color: #2b91af">ApplicationException</span></span>(<span><span style="color: #a31515">&quot;Don't delete me or my relatives!&quot;</span></span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">public</span></span>&#160;<span><span style="color: #2b91af">IEnumerable</span></span>&lt;<span><span style="color: #2b91af">Contact</span></span>&gt; GetContactsWithSuffixesBecauseTheyAreAwesome()<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">var</span></span> repo = GetStore();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">return</span></span> repo.Some(p =&gt; p.Suffix != <span><span style="color: #0000ff">null</span></span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">public</span></span>&#160;<span><span style="color: #0000ff">void</span></span> JustGoAheadAndMakeSureEveryoneHasSuffixesNow()<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">var</span></span> repo = GetStore();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">var</span></span> unsuffixedPeeps = repo.Some(p =&gt; p.Suffix == <span><span style="color: #0000ff">null</span></span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span><span style="color: #0000ff">foreach</span></span> (<span><span style="color: #0000ff">var</span></span> peep <span><span style="color: #0000ff">in</span></span> unsuffixedPeeps)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; peep.Suffix = <span><span style="color: #a31515">&quot;Esq.&quot;</span></span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br />}</span></span><br /></pre>

And that's more or less all you're left holding the bag for. I know, right?

<p>That <em>Contact</em> object (and all of its brother and sister data objects) is just a POCO, in this instance generated by <a href="http://blogs.microsoft.co.il/blogs/gilf/archive/2010/12/08/ef-feature-ctp5-walkthrough-for-the-new-dbcontext-t4-template.aspx" target="_blank">Entity Framework's new DbContext T4</a>. But of course, a POCO is a POCO is a POCO--ignorant of its comings and goings, just like we like 'em here in DDD-ville.</p>

<h2>Um. What?</h2>

<p>The magic is all in <strong>Ignorance</strong>'s dependence on <a href="http://en.wikipedia.org/wiki/Dependency_injection" target="_blank">Dependency Injection</a>, courtesy of <a href="http://unity.codeplex.com/" target="_blank">Unity</a>. Here's the relevant config section for the above app that glues everything together:</p>

<pre style="background: white"><span style="font-family: consolas"><span><span style="color: #0000ff"><span>&#160; &lt;</span></span></span><span><span><span style="color: #a31515">unity</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">xmlns</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">http://schemas.microsoft.com/practices/2010/unity</span></span>&quot;</span></span><span><span style="font-family: consolas"><span style="color: #0000ff"><span>&gt;</span><br /></span></span><span style="font-family: consolas"><span style="color: #0000ff"><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">alias</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">alias</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">IWork</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">Ignorance.IWork, Ignorance</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">alias</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">alias</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">IStore</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">Ignorance.IStore`1, Ignorance</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">alias</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">alias</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">EntityFrameworkWork</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">Ignorance.EntityFramework.Work, Ignorance</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">alias</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">alias</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">EntityFrameworkStore</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">Ignorance.EntityFramework.Store`1, Ignorance</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">alias</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">alias</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">LinqToSqlWork</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">Ignorance.LinqToSql.Work, Ignorance</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">alias</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">alias</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">LinqToSqlStore</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">Ignorance.LinqToSql.Store`1, Ignorance</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span></span></span><span style="font-family: consolas"><span style="color: #0000ff"><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">alias</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">alias</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">AdventureWorksEntities</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">YourApplicationHere.Data.EntityFramework.AdventureWorksEntities, <span><span style="color: #0000ff">YourApplicationHere</span></span></span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">alias</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">alias</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">DbContext</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">System.Data.Entity.DbContext, EntityFramework</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">assembly</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">name</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">Ignorance</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span>/&gt;</span><br /><span>&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">container</span></span></span><span style="font-family: consolas"><span style="color: #0000ff"><span>&gt;</span><br /><span>&#160;&#160;&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">register</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">IWork</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">mapTo</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">EntityFrameworkWork</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span>&gt;</span><br /><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">constructor</span></span></span><span style="font-family: consolas"><span style="color: #0000ff"><span>&gt;</span><br /><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">param</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">name</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">context</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">dependencyType</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">AdventureWorksEntities</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">DbContext</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span></span><span><span style="color: #a31515">constructor</span></span></span><span style="font-family: consolas"><span style="color: #0000ff"><span>&gt;</span><br /><span>&#160;&#160;&#160;&#160;&#160; &lt;/</span></span><span><span style="color: #a31515">register</span></span></span><span style="font-family: consolas"><span style="color: #0000ff"><span>&gt;</span><br /><span>&#160;&#160;&#160;&#160;&#160; &lt;</span></span><span><span style="color: #a31515">register</span></span><span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">type</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">IStore</span></span>&quot;<span><span style="color: #0000ff">&#160;</span></span><span><span style="color: #ff0000">mapTo</span></span><span><span style="color: #0000ff">=</span></span>&quot;<span><span style="color: #0000ff">EntityFrameworkStore</span></span>&quot;</span><span style="font-family: consolas"><span style="color: #0000ff"><span> /&gt;</span><br /><span>&#160;&#160;&#160; &lt;/</span></span><span><span style="color: #a31515">container</span></span></span></span><span style="font-family: consolas"><span><span style="color: #0000ff"><span>&gt;</span><br /><span>&#160; &lt;/</span></span><span><span style="color: #a31515">unity</span></span></span><span><span style="color: #0000ff">&gt;</span></span></span></pre>

<p>Ignorance comes with pre-implemented Work/Store pairs for Entity Framework and LINQ To SQL storage. But if your fav ORM is <em>other</em>, it's pretty straightforward to cook one up--just implement the <em>Ignorance.IWork</em> and <em>Ignorance.</em><em>IStore</em> interfaces, or inherit the <em>Ignorance.</em><em>Work</em> and <em>Ignorance.</em><em>Store</em> classes.</p>

<p>For instance, here's all I had to do for the LINQ to SQL pair:</p>

<pre style="font-family: ; background: white; color: "><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 9.8pt">using</font></font></span><font style="font-size: 9.8pt"> System.Collections;<br /><span style="color: "><font color="#0000ff">using</font></span> System.Data.Linq;<br /><span style="color: "><font color="#0000ff">using</font></span> System.Linq;<br /> <br /><span style="color: "><font color="#0000ff">namespace</font></span> Ignorance.LinqToSql<br />{<br />&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">class</font></span>&#160;<span style="color: "><font color="#2b91af">Work</font></span> : Ignorance.<span style="color: "><font color="#2b91af">Work</font></span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#2b91af">DataContext</font></span> DataContext { <span style="color: "><font color="#0000ff">get</font></span>; <span style="color: "><font color="#0000ff">set</font></span>; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span> Work(<span style="color: "><font color="#2b91af">DataContext</font></span> context)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">this</font></span>.DataContext = context;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">protected</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#0000ff">void</font></span> Commit()<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">this</font></span>.DataContext.SubmitChanges();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#0000ff">void</font></span> Dispose()<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">this</font></span>.DataContext.Dispose();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#2b91af">ICollection</font></span> Added<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">get</font></span> { <span style="color: "><font color="#0000ff">return</font></span>&#160;<span style="color: "><font color="#0000ff">this</font></span>.DataContext.GetChangeSet().Inserts <span style="color: "><font color="#0000ff">as</font></span>&#160;<span style="color: "><font color="#2b91af">ICollection</font></span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#2b91af">ICollection</font></span> Updated<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">get</font></span> { <span style="color: "><font color="#0000ff">return</font></span>&#160;<span style="color: "><font color="#0000ff">this</font></span>.DataContext.GetChangeSet().Updates <span style="color: "><font color="#0000ff">as</font></span>&#160;<span style="color: "><font color="#2b91af">ICollection</font></span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#2b91af">ICollection</font></span> Deleted<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">get</font></span> { <span style="color: "><font color="#0000ff">return</font></span>&#160;<span style="color: "><font color="#0000ff">this</font></span>.DataContext.GetChangeSet().Deletes <span style="color: "><font color="#0000ff">as</font></span>&#160;<span style="color: "><font color="#2b91af">ICollection</font></span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">class</font></span>&#160;<span style="color: "><font color="#2b91af">Store</font></span>&lt;T&gt; : Ignorance.<span style="color: "><font color="#2b91af">Store</font></span>&lt;T&gt; <span style="color: "><font color="#0000ff">where</font></span> T : <span style="color: "><font color="#0000ff">class</font></span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span> Store(<span style="color: "><font color="#2b91af">Work</font></span> work) : <span style="color: "><font color="#0000ff">base</font></span>(work) { }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">protected</font></span>&#160;<span style="color: "><font color="#0000ff">virtual</font></span>&#160;<span style="color: "><font color="#2b91af">DataContext</font></span> Context<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">get</font></span> { <span style="color: "><font color="#0000ff">return</font></span> (<span style="color: "><font color="#0000ff">this</font></span>.Work <span style="color: "><font color="#0000ff">as</font></span> LinqToSql.<span style="color: "><font color="#2b91af">Work</font></span>).DataContext; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">protected</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#2b91af">IQueryable</font></span>&lt;T&gt; Data<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">get</font></span> { <span style="color: "><font color="#0000ff">return</font></span>&#160;<span style="color: "><font color="#0000ff">this</font></span>.Table <span style="color: "><font color="#0000ff">as</font></span>&#160;<span style="color: "><font color="#2b91af">IQueryable</font></span>&lt;T&gt;; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">protected</font></span>&#160;<span style="color: "><font color="#0000ff">virtual</font></span>&#160;<span style="color: "><font color="#2b91af">Table</font></span>&lt;T&gt; Table<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">get</font></span> { <span style="color: "><font color="#0000ff">return</font></span>&#160;<span style="color: "><font color="#0000ff">this</font></span>.Context.GetTable&lt;T&gt;(); }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#0000ff">void</font></span> Remove(T entity)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">this</font></span>.Table.DeleteOnSubmit(entity);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#0000ff">void</font></span> Attach(T entity)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">this</font></span>.Table.Attach(entity, <span style="color: "><font color="#0000ff">true</font></span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">public</font></span>&#160;<span style="color: "><font color="#0000ff">override</font></span>&#160;<span style="color: "><font color="#0000ff">void</font></span> Add(T entity)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: "><font color="#0000ff">this</font></span>.Table.InsertOnSubmit(entity);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br />}</font></font><br /></pre>

<p>Seriously.</p>

## Dependencies ##

[Unity](http://msdn.microsoft.com/en-us/library/ff663144.aspx)

## Microsoft Public License (MS-PL) ##

This license governs use of the accompanying software. If you use the software, you
accept this license. If you do not accept the license, do not use the software.

1. **Definitions**
The terms "reproduce," "reproduction," "derivative works," and "distribution" have the
same meaning here as under U.S. copyright law.
A "contribution" is the original software, or any additions or changes to the software.
A "contributor" is any person that distributes its contribution under this license.
"Licensed patents" are a contributor's patent claims that read directly on its contribution.

2. **Grant of Rights**
(A) Copyright Grant- Subject to the terms of this license, including the license conditions and limitations in section 3, each contributor grants you a non-exclusive, worldwide, royalty-free copyright license to reproduce its contribution, prepare derivative works of its contribution, and distribute its contribution or any derivative works that you create.
(B) Patent Grant- Subject to the terms of this license, including the license conditions and limitations in section 3, each contributor grants you a non-exclusive, worldwide, royalty-free license under its licensed patents to make, have made, use, sell, offer for sale, import, and/or otherwise dispose of its contribution in the software or derivative works of the contribution in the software.

3. **Conditions and Limitations**
(A) No Trademark License- This license does not grant you rights to use any contributors' name, logo, or trademarks.
(B) If you bring a patent claim against any contributor over patents that you claim are infringed by the software, your patent license from such contributor to the software ends automatically.
(C) If you distribute any portion of the software, you must retain all copyright, patent, trademark, and attribution notices that are present in the software.
(D) If you distribute any portion of the software in source code form, you may do so only under this license by including a complete copy of this license with your distribution. If you distribute any portion of the software in compiled or object code form, you may only do so under a license that complies with this license.
(E) The software is licensed "as-is." You bear the risk of using it. The contributors give no express warranties, guarantees or conditions. You may have additional consumer rights under your local laws which this license cannot change. To the extent permitted under your local laws, the contributors exclude the implied warranties of merchantability, fitness for a particular purpose and non-infringement.